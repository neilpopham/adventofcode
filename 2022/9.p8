pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
-- advent of code 2022 day 9
-- by neil popham

function _init()
cls()
 --data={'r2','d2','u2','d1','l1','d2','r2','l2','r1','d2','l1','u2','r1','d1','r1','l1','d1','r2','u2','l2','r2','u2','r1','l1','d2','r1','d1','r1','d1','r1','l2','r1','d1','l1','u2','l1','d1','l1','r1','u2','d1','u2','l2','r2','d1','l1','r1','d1','l1','u1','r2','d1','r1','d2','l1','d2','l1','d2','r1','l1','d2','l1','r1','d2','l2','r2','l1','u2','r1','u2','r2','u1','d1','u2','l1','d2','l2','r2','l1','r1','u2','d1','r1','l2','u1','d2','u1','l2','r2','d1','u1','l2','u2','l1','r1','d1','r2','d1','r1','d2','r1','d1','r1','d2','l2','u2','l1','d1','l1','r2','u1','d1','u2','l2','d3','l3','u3','r1','d3','r1','d3','r2','d2','u3','d2','l3','r3','u3','r1','u3','d3','l1','d2','u1','r2','l2','r3','l2','d3','l2','r1','d1','u1','d2','r2','l1','u1','r3','u2','d3','l3','u2','l3','r2','d2','u2','r1','u3','r2','d1','u2','d3','u2','r3','u2','l3','u3','d2','r3','u3','l3','u2','l1','d3','l2','d3','r3','l2','r3','d1','u1','l3','r3','d2','l3','u2','r2','u1','r3','d3','r1','u2','l2','u1','r1','u1','d2','l2','r1','d3','r1','d3','u1','r2','u2','l2','u2','l3','d3','u2','l3','u1','l2','d1','u3','l2','r3','d1','r3','l3','u1','l3','r2','d3','u3','l3','d4','l1','u1','r3','l1','d4','u4','l4','d4','u1','d3','r1','d4','l1','u2','d1','r3','l4','d2','u2','r1','l4','u4','r4','d1','r3','d1','r4','u4','d1','u3','d4','l3','r2','d4','l2','u4','d3','u4','d2','u2','l3','r4','l4','u2','l1','u4','d4','r4','u4','r2','u4','r1','u3','r3','u4','r4','u2','l1','u3','d4','l1','r1','l2','r2','d2','u3','r3','l1','d2','r4','d1','r4','l2','u4','d2','r4','u2','d4','r1','u3','l3','d2','r2','u1','l4','r1','u2','r4','d3','r1','l2','u1','r2','l2','u2','r3','l2','d4','u4','l1','u2','d1','u2','d1','l2','r4','l5','d2','u5','l1','r2','l3','u3','d3','l1','d1','u4','l4','u3','d5','r1','l4','u1','l2','r4','d1','l4','d1','u4','d1','l2','d5','l5','d4','r3','u2','l4','u4','l4','r5','d1','l2','r5','u4','d5','l2','u4','d1','l3','r5','d4','l1','d3','l3','u2','r2','d4','l4','u1','d2','l5','d2','l2','u3','r3','u3','d2','u4','r3','l3','d2','l2','r3','d2','l3','r4','u4','r4','d2','r1','d1','l4','r4','d3','r2','u4','l2','d3','u4','l3','r5','l2','r1','d4','l5','d2','u5','l4','u2','r3','l4','r1','u3','r3','l2','u2','l3','r5','l3','r3','u3','l3','u5','d4','u5','d4','l4','d2','r5','l3','u2','d3','l4','r1','d1','r5','l3','r2','l3','u3','d1','u5','r2','l2','d5','r3','u4','r3','l1','r6','l4','d4','u4','r4','u2','r4','d1','u3','r1','u5','d3','l4','r5','l3','u6','l5','d3','r1','d2','u5','l1','r5','u4','r1','u1','r3','l2','d5','u4','l1','u2','r3','l5','r2','d3','u3','d6','r1','d2','l3','r3','l3','u4','r4','u4','r6','u1','l6','r6','l4','u6','l2','d1','r5','l5','u3','d6','u5','l4','u2','r1','l3','d6','u5','r4','u2','d3','r4','l1','d4','u6','r1','d6','u2','d5','u4','l4','r6','d2','r6','l1','r3','d4','r5','l6','u5','l3','r6','u1','l3','d7','u2','d5','r5','d7','r6','d6','r7','d7','l3','r4','l1','u6','r2','l7','u7','d1','r1','d1','u5','r4','u2','d5','u6','l2','r1','u5','l1','u7','r1','d2','l4','d4','l5','u4','l2','d5','r7','d7','r5','l3','u7','r7','d1','l2','u3','l2','u7','l2','u3','l6','d6','l2','d6','l6','u3','l3','u7','d3','l4','u5','d5','l4','d7','u3','r7','d5','r3','l6','u2','l2','u1','l1','u4','d7','l7','d2','u6','l2','u2','l4','r3','l6','r2','d7','l6','d3','l6','r1','u4','r6','l7','d7','r4','u7','l6','r3','d1','u3','d2','u3','r2','l7','u1','r4','d4','u2','r5','d5','r4','l3','u1','r7','l5','d4','l3','d7','u2','d4','u4','l1','d4','r7','l6','u3','l4','d5','u1','d1','l6','r7','d1','l4','d1','l5','r8','d4','l8','r4','d4','u3','l5','r5','l8','u4','r2','d6','r5','l1','u8','l1','d5','u5','d4','l6','u6','d8','r6','d3','u7','r8','d7','l2','u4','d4','l2','r2','u5','l4','r3','l2','u5','d8','l8','d3','u4','d2','l2','u4','r5','l6','u4','r5','u4','l7','d8','r8','d7','r5','d6','u2','r1','d3','l6','u3','d5','u6','l7','r1','l4','r4','l4','r3','l4','u3','d7','u8','d4','r6','l7','r2','l2','u7','d2','r1','d5','u1','d7','r2','l8','r8','u4','r9','l4','r5','l2','d6','l9','u2','r5','d4','r9','u4','d8','r9','u5','d4','u4','l4','u3','r5','l8','d9','u2','l8','u5','d4','l1','d4','u3','d7','u5','d5','r9','l2','d5','l7','d1','l2','r6','d9','u1','l6','r2','d2','r5','d8','r2','d3','l4','d5','r2','d8','l3','d6','u2','l4','d9','l6','r5','l7','u2','d8','u5','l6','u1','l9','r9','d1','r3','u9','l2','u8','r8','d8','r7','u7','r6','l2','u4','d2','l4','u4','d2','r8','l6','r9','d9','l6','d4','l5','u8','d2','r6','d7','u3','r6','l9','u6','l8','u8','d6','u9','d5','u8','l6','r6','l6','r9','l2','u4','l4','u1','d4','r1','u7','d5','r4','u4','d5','l9','r2','u5','l2','r10','l5','r1','l2','u3','d2','r7','l2','r6','l3','r6','u7','l1','u6','r6','u2','l3','r3','l1','r9','l5','u9','l9','d9','u4','d2','r6','d6','r8','d2','u6','l5','r2','u10','l3','d6','r3','d6','u2','d7','r1','u7','d2','r8','l5','u4','l5','r6','u6','d1','l5','d5','r5','d4','l5','u3','r4','l5','r2','l5','d10','r4','l2','r4','l7','u9','r3','d6','r7','l10','d7','u4','l9','d6','l7','r3','u7','r5','u6','l1','u2','l5','d6','r8','l7','r7','d1','u9','r1','l4','u4','r1','l3','d2','l8','d10','l9','d8','r5','d6','l7','d2','u11','d2','u6','l3','u8','d11','u9','d9','r11','u11','l8','u11','r11','u2','d6','r11','d7','l6','u5','r1','l3','d11','u3','d5','r4','u4','d8','l6','u1','r10','l5','d3','u8','r7','l8','r2','u6','d9','r1','d1','r3','u3','l10','u7','r1','d3','u6','l10','r6','l6','r4','l2','r10','l11','u5','r5','u5','r2','d10','l8','u9','d11','r10','d11','r11','d2','u7','r11','u2','l9','r11','u1','r8','l5','u6','d5','l10','u1','l4','r7','l5','d2','r9','d10','u4','r1','d7','r10','d10','l5','r3','l8','r8','u10','r9','d11','r1','d9','r5','l3','d5','l8','u8','r10','d10','u1','d3','r6','u1','l2','u6','l7','r11','u2','r2','l5','u5','r2','d12','u3','l2','d5','u3','r11','d5','r10','u8','l7','r6','d2','u11','l10','r12','d8','u12','l7','d5','r11','u10','r12','u1','l1','u10','l2','r9','u1','r4','u2','r8','d1','r2','l3','r7','d7','l10','r2','u11','r8','u11','d12','u8','l5','u12','l12','u12','l7','r5','d4','u9','l5','r7','l10','r4','l11','d3','r1','d12','u10','r10','d5','r11','u2','l8','r4','d1','l10','r2','d11','l4','u12','d11','l11','u3','l9','u8','d8','r10','l8','u2','d9','u12','d7','u8','l8','d9','l6','u8','d11','u12','d9','l1','d4','r2','u10','d2','l10','u6','l9','d4','u4','r4','l5','r9','u2','r5','u4','d12','r3','l10','u7','d1','u9','r6','l4','u9','l13','d2','l8','r12','d7','u13','d6','u12','l4','r4','d10','u8','l4','r4','d2','u9','l9','d11','l6','r2','l8','r9','l6','u13','r10','d3','u10','l12','r9','u12','r10','u10','d11','l7','r5','l13','u11','r13','u11','r12','u8','r12','d4','l10','r1','l9','r13','l2','u7','l13','r4','u13','l6','r12','d1','u7','l10','r6','d6','u2','r2','l8','d5','u9','d5','l9','r1','u5','l13','d1','r5','l8','u5','r2','u8','l1','u13','r6','u12','l3','d1','u4','l12','r1','d6','l11','u7','d1','l9','r4','u7','d7','u9','d1','l10','d14','u3','d9','l7','u1','l9','r13','l14','r11','d8','l12','u11','r11','u9','r2','u13','r5','d3','u3','r9','d14','u2','d8','l7','d2','u8','l12','u7','d12','r11','d14','r13','l13','r9','l7','u4','d9','u9','l12','u3','d4','r5','d14','l9','d14','u3','l8','r1','u2','r14','d5','l6','r9','d12','r3','d1','l8','u11','d11','l7','r14','d9','l9','r13','l4','d11','r14','u6','l10','r7','d9','u7','d5','r8','u2','r9','d6','r13','u1','l14','r6','l9','d11','l3','u5','r12','u8','l3','d5','u7','r2','d14','r14','l2','u5','l11','u7','l14','u5','d6','r14','d12','u4','d5','r14','l14','d12','l10','d2','l1','r5','d8','r2','l14','r5','l12','d9','l6','d8','l8','r12','u1','l11','u3','d7','r11','d15','l4','u9','r15','u8','d4','l10','u2','l13','u9','l5','d13','l5','r1','d3','u11','d5','l13','r3','d4','u3','r5','u14','r4','d9','r3','d11','u13','r7','u10','r1','l9','d15','r6','u12','l4','r13','u7','d10','r13','u1','r4','d15','l10','r11','u9','l1','d6','r15','u10','l10','d6','u10','l8','r5','l14','d6','l2','u2','l9','u2','l7','u9','l2','d8','r6','d6','r7','u2','l13','r13','u3','d13','u14','r9','l4','u15','r1','d2','u15','r12','u12','l12','u9','r8','u3','l7','d3','u2','r7','d4','r6','u13','d7','u7','d8','r13','u10','d16','l12','u8','r6','u10','l14','d12','r2','l9','u8','d7','u6','r7','l14','d6','l10','u11','l3','d6','r2','u8','l2','d10','r16','u14','r10','d13','r3','d8','r2','d16','l12','d13','u6','d2','l4','r14','d16','u12','l1','d9','l7','u1','l3','u7','r7','d3','l11','r9','d5','r10','d12','r1','u8','l8','d5','r12','u8','r11','u3','d5','r9','l11','u14','l14','d5','u12','l9','d2','u6','l7','d6','l2','r2','d11','r13','d10','u4','l13','u5','l6','r3','u16','d13','r1','u2','d4','r3','u10','d16','l1','u1','r16','d6','u7','d3','r4','u2','d4','l8','u9','r8','u15','d4','r11','d4','r12','u1','d2','r4','d17','l4','u1','d1','l3','r16','d12','r6','u3','r4','u2','d8','r5','d4','r1','u5','l12','d1','r12','u3','d13','l13','u11','d8','r3','d14','l10','d1','l4','d4','r9','l10','u6','l8','r7','l2','r1','l4','d8','r14','u8','l13','d12','r17','d2','r5','u12','r8','d16','l6','r14','d9','u7','l5','u14','l10','u5','l4','u7','r17','d1','u6','l12','d10','l2','d17','l14','r3','d6','u11','r14','l11','d8','u1','r1','l14','u17','l15','u3','r5','d3','l12','r10','u17','r7','d2','u16','d10','l12','r5','d10','l14','d17','u4','l9','d11','r5','d4','u5','l16','d16','l5','u10','d8','l14','u11','l17','d1','u10','r9','u17','l8','r11','l15','d9','u18','d3','r4','l7','r2','u5','l17','u2','r11','l11','u7','d17','u11','r5','d14','u7','r17','d10','u18','d15','l7','u2','d3','u14','r6','d2','l5','r16','d8','u2','d16','r9','u12','r4','d14','r10','u1','r1','l8','d15','l8','d16','u9','r11','l17','u18','l2','r4','l1','u9','l13','r1','u17','l12','r3','d15','r3','u3','d8','l6','r4','d13','u2','r1','l10','u9','r2','d16','r9','u15','r10','u4','r6','d10','u4','r11','d1','r10','u17','r4','d9','u17','r7','u11','l10','r10','l10','u8','l18','u14','r16','l12','u18','r1','d4','l9','r18','d12','l17','d12','u4','d1','u16','r17','u3','d13','l14','d9','l19','u13','l2','u9','d7','u7','d4','l10','r6','d11','r7','u10','d13','u18','l14','d7','l4','r11','d8','l8','r9','l2','u11','r13','l13','r11','l16','d10','l6','r3','d8','l19','u18','l14','d15','u10','d11','r19','d14','u2','r7','u6','d15','u10','d4','u10','l9','r15','l8','u7','r4','d5','r18','l3','r11','d11','r2','u1','l6','d18','r15','u2','r10','l18','r1','u19','d15','r18','l18','r4','l7','d18','r19','u11','d3','l3','r11','u16','r3','d4','u2','r10','u9','l18','u6','l5','d7','l17','u3','l5','d6','u19','r14','u3','d1','u16','l16','d12','l11','d16','r15','u5','d14','l3','u18','l8','u10','l10','d10','r5'}
 data={'r5','u8','l8','d3','r17','d10','l25','u20'}
 pos={{x=0,y=0}}
 map={u={0,-1},d={0,1},l={-1,0},r={1,0}};
 knots={}
 for i=1,10 do
  add(knots,{x=0,y=0})
 end
 t=1
 m=1
 i=2
 extcmd("rec")
end

function _update60()
 if i==2 then

  if m==1 then
   move=data[t]
   if move==nil then
    --extcmd("video")
    printh('done')
    return
   end
   d=sub(move,1,1)
   n=tonum(sub(move,2))
   delta=map[d]
  end

  knots[1].x+=delta[1]
  knots[1].y+=delta[2]
 end

 hx=knots[i-1].x
 hy=knots[i-1].y
 tx=knots[i].x
 ty=knots[i].y
 ox=tx
 oy=ty

 if tx~=hx then
  tx+=(hx>tx and 1 or -1)
 end
 if ty~=hy then
  ty+=(hy>ty and 1 or -1)
 end
 if tx==hx and ty==hy then
  tx=ox
  ty=oy
 end

 knots[i]={x=tx,y=ty}

 i+=1

 if i>10 then
  add(pos,{x=tx,y=ty})
  i=2
  m+=1
 end

 if m>n then
  m=1
  t+=1
 end
end

function _draw()
 if move==nil then
  cls()
  for _,p in pairs(pos) do
   rectfill(dx+p.x*z-w,dy+p.y*z-w,dx+p.x*z+w,dy+p.y*z+w,2)
   --circfill(dx+p.x*z,dy+p.y*z,w,2)
  end
  return
 end
 if i~=2 then return end
 cls(0)
 if move==nil then
  return
 end
 z=4
 w=1
 dx=64
 dy=64
 for _,p in pairs(pos) do
  rectfill(dx+p.x*z-w,dy+p.y*z-w,dx+p.x*z+w,dy+p.y*z+w,2)
  --circfill(dx+p.x*z,dy+p.y*z,w,2)
 end
 for k, knot in pairs(knots) do
  if k>1 then
   line(dx+knots[k].x*z,dy+knots[k].y*z,dx+knots[k-1].x*z,dy+knots[k-1].y*z,13)
  end
 end
 for k=10,1,-1 do
  rectfill(dx+knots[k].x*z-w,dy+knots[k].y*z-w,dx+knots[k].x*z+w,dy+knots[k].y*z+w,5+k)
  --circfill(dx+knots[k].x*z,dy+knots[k].y*z,w,5+k)
 end
end
