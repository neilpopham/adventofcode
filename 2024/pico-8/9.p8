pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
-- advent of code day 9 2024
-- by neil popham

data = "216756491169358392398129475754743413109164963752215967748195906974548675496961102765802254422554825635465459313115518926937365767658302457893967378488247441906363785875495766906076808045215264511335179714327955508834805623554214724827949034181660433277566224411135868990624072785842152331896775183175573265997052781010311770423623112495293655821245639946763681513140873062841866871364122533588458973163259097653150377712792659244791631717818636858791663745385384973185378316341212786852124621685851608091854649618775703724836198197979813348473580582670949850325094285528464762795320567493698972606646111844947336641010494667647796497399442168873577552594208615954512752711679167591255352233153330782920397434154755588267262152802265412167583251566725431917543591977619425598684045807482591787935650459918278185517322664586283810727989787349899575441622147193795266254665829216471732424023853197383876765482474458498156508487955141338059906064859756394557556714316975551045384350446512122631667243883359226987954353913138215652424854725843447416681434395276851852372354404729992451411613652357817175807946971814449055594974466122932033386047104886899992805464504037715433875662986630117291216757103449532147285047308537259743123850585620885518302283313649318664925027119443336855602524621268177635242152967447222457815530242716557111192512497655397889544786117956927963752239204746856145659019573055891136322619954832325481765812146044687763981678156999141599526985177515324691799490983664781258357484572559444387297410312427358070469181381330908739694885415398284513768441903210239959381220374036775046911793494225187186483556955184829352343219196555871687929931706843216287243288841591686475985511446371643185681184187431261428657755692158437651854089393073797839159230999731276319384830525389773039601958558658403857785767148870922497966452934628634837647441556913321794871168794469287117758943844227157998108095112032377389518098129167242630129821645910332353546426793396927987185158866191609577445280724256603139796889826188796331462940239054284139408389678718455364174950617945171998723645679970161049979015925113683243694587587131879618742589761558935386235020724540876598704387713130363652183673928167529540765817683160882771404075433316251981979073107774823156795357595238438829581436738283645173368945962690444520896327198053321551294422105553212749638252822663954398612535711644755014691354903256559242551032412923274056292798765588672828165053253468625586967044966297684212943776578220881625243639373313669654482856956699723758373433748231726363386596405964454745349960977538768145708173666440796676677797243953539752276314915598705637121267295648898159339622556469488188585761713534763555794081725861231561798228357883629367647940812397754031195086679769279494626670465875786612838632463035833727623742735084533712894247156261389681975377523385604052761658275927807578989959117380104728124978178348129694884450144266664115972460442454779959595995833523787971899669655229495155225894167175795627817271822454417766631785757967139839249473899042174277848087451027549670166176724615608278276544728138917336655196479722677720959640358496866077927964395316547416259336886773933445749553924280299091242937392276115898194181287164758425308680615141991855684928615040379624289276929246388996525469966487472541426594497889488925272852512291266943645832821741995058165952287223987185237672858672865575"
files = {}
spaces = {}
id = 1
s = 1
moving = true
t = 0

function _init()
    local p = 1
    for i = 1, #data do
        n = tonum(data[i])
        printh(n)
        if i % 2 == 1 then
            files[id] = {{first = p, last = p + n - 1}}
            id += 1
        elseif n > 0 then
            add(spaces, {first = p, last = p + n - 1})
        end
        p += n
    end
    extcmd("rec")
end

function _update()
    if moving == false then
        t += 1
        if t == 60 then extcmd("video") end
        return
    end

    t += 1
    if t % 2 != 0 then return end

    id -= 1

    local size = 1 + files[id][1].last - files[id][1].first
    local required = size

    while required > 0 do
        if spaces[s].first > files[id][1].first then
            moving = false
            t = 0
            break
        end

        local space = 1 + spaces[s].last - spaces[s].first
        if space < required then
            add(files[id], spaces[s])
            files[id][1].last -= space
            required -= space
            s += 1
        elseif space > required then
            files[id][1] = {first = spaces[s].first, last = spaces[s].first + required - 1};
            spaces[s].first += required;
            required = 0
        else
            files[id][1] = spaces[s]
            required = 0
            s += 1
        end
    end
end

function _draw()
    cls(0)
    for uid, blocks in pairs(files) do
        local col = moving and uid == id and 8 or 2
        for b, block in pairs(blocks) do
            for bx = block.first, block.last do
                local x = (bx - 1) % 128
                local y = flr((bx - 1) / 128)
                pset(x, y, col)
            end
        end
    end
end